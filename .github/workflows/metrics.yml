name: 🚀 GitHub Metrics Generator

on:
  # Schedule daily updates at 2 AM UTC
  schedule: [{cron: "0 2 * * *"}]
  # Run workflow manually
  workflow_dispatch:
  # Run workflow when pushing to main
  push: {branches: ["main"]}

jobs:
  github-metrics:
    runs-on: [self-hosted, linux, x64]
    permissions:
      contents: write
    steps:
      - name: 📊 Generate GitHub Metrics
        uses: lowlighter/metrics@latest
        with:
          # 🔑 Authentication
          token: ${{ secrets.METRICS_TOKEN }}
          
          # 🎨 Template & Display
          template: classic
          
          # 📁 Base Content - Main Stats
          base: header, activity, community, repositories, metadata
          
          # 🧮 Traffic Stats
          plugin_traffic: true
          
          # ⏰ WakaTime Stats
          plugin_wakatime: true
          plugin_wakatime_token: ${{ secrets.WAKATIME_TOKEN }}
          plugin_wakatime_sections: time,projects,languages,editors
          plugin_wakatime_days: 30
          plugin_wakatime_limit: 5
          
          # ⚙️ Configuration
          config_timezone: America/New_York
          
          # 📤 Output
          filename: github-metrics.svg
          output_action: commit
          output_condition: data-changed
          committer_message: "🚀 Auto-generated metrics for run #${{ github.run_number }}"